<!-- Pricing -->
{{#get
"tiers" include="monthly_price,yearly_price,benefits" limit="all"
as |tiers|
}}
<div class="max-w-[85rem] px-4 py-10 sm:px-6 lg:px-8 lg:py-14 mx-auto">
    <!-- Title -->
    <div class="max-w-2xl mx-auto text-center mb-10 lg:mb-14">
        <h2 class="text-2xl font-bold md:text-4xl md:leading-tight dark:text-white">Membership</h2>
        <p class="mt-1 text-gray-600 dark:text-gray-400">
            Choose your subscription plan and get access to different member-only
            benefits.</p>
    </div>

    <!-- Toggle -->
    <div class="flex justify-center mb-4">
        <div>
            <label for="toggle-count-switch" class="inline-block p-2">
                <span
                    class="data-plan-label monthly inline-block text-sm text-gray-800 cursor-pointer dark:text-gray-200">
                    Monthly
                </span>
            </label>
            <input id="toggle-count-switch" name="toggle-count-switch" role="switch" type="checkbox" checked
                onchange="onDataPlanSwitch()"
                class="js-plan-toggle relative w-[3.25rem] h-7  bg-purple-500 border-2 border-transparent rounded-full cursor-pointer transition-colors ease-in-out duration-200 ring-1 ring-transparent focus:border-blue-600 focus:ring-blue-600 ring-offset-white focus:outline-none appearance-none dark:bg-gray-700 dark:focus:ring-offset-gray-800 before:inline-block before:size-6  before:bg-purple-200 before:translate-x-full before:shadow before:rounded-full before:transform before:ring-0 before:transition before:ease-in-out before:duration-200  dark:before:bg-purple-200" />
            <label for="toggle-count-switch" class="relative min-w-14 text-sm text-gray-500 ms-3 dark:text-gray-400">
                <span
                    class="data-plan-label annual inline-block text-sm text-gray-800 cursor-pointer dark:text-gray-200">
                    Annual
                </span>
            </label>
        </div>
    </div>
    <!-- End Toggle -->



    <!-- Grid -->
    <div class="mt-12 grid sm:grid-cols-2 lg:grid-cols-4 gap-6 lg:items-center">
        {{#foreach tiers}}
        <!-- Card -->
        <div class="flex flex-col border border-gray-200 text-center rounded-xl p-8 dark:border-gray-700">
            <h4 class="font-medium text-lg text-gray-800 dark:text-gray-200">{{name}}</h4>

            {{#match type "free"}}
            <span class="mt-7 font-bold text-5xl text-gray-800 dark:text-gray-200">{{price 0 currency="USD"}}</span>
            {{/match}}

            {{#if monthly_price}}
            <span data-plan="monthly" class="mt-7 font-bold text-5xl text-gray-800 dark:text-gray-200">{{price
                monthly_price currency=currency}} <span class="text-xs">{{t "/month"}}</span></span>
            {{/if}}

            {{#if yearly_price}}
            <span data-plan="annual" class="price mt-7 font-bold text-5xl text-gray-800 dark:text-gray-200">{{price
                yearly_price currency=currency}} <span class="text-xs">{{t "/year"}}</span>
            </span>
            <span data-discount data-plan="annual" data-monthly-price="{{price monthly_price}}" data-yearly-price="{{price yearly_price}}"
                class="discount mt-3 inline-block whitespace-nowrap text-[11px] leading-5 font-semibold tracking-wide uppercase bg-gradient-to-bl from-purple-500 via-violet-600 to-blue-600 rounded-2xl text-white py-1 px-2.5">{{t
                "discount"}}</span>

            {{/if}}


            <p class="mt-2 text-sm text-gray-500">{{description}}</p>
            <ul class="mt-7 space-y-2.5 text-sm">
                {{#foreach benefits as |benefit|}}
                <li class="flex space-x-2">
                    <svg class="flex-shrink-0 mt-0.5 size-4 text-blue-600 dark:text-blue-500"
                        xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none"
                        stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <polyline points="20 6 9 17 4 12" />
                    </svg>
                    <span class="text-gray-800 dark:text-gray-400 text-left">
                        {{benefit}}
                    </span>
                </li>
                {{/foreach}}
            </ul>

            {{#match type "free"}}
            <a href="/signup"
                class="mt-5 py-3 px-4 inline-flex justify-center items-center gap-x-2 text-sm font-semibold rounded-lg border border-transparent bg-blue-100 text-blue-800 hover:bg-blue-200 disabled:opacity-50 disabled:pointer-events-none dark:hover:bg-blue-900 dark:text-blue-400"
                href="#">
                Sign up
            </a>
            {{/match}}

            {{#if monthly_price}}
            <a href="javascript:" data-plan="monthly" data-portal="signup/{{id}}/monthly"
                class="mt-5 py-3 px-4 inline-flex justify-center items-center gap-x-2 text-sm font-semibold rounded-lg border border-transparent bg-blue-100 text-blue-800 hover:bg-blue-200 disabled:opacity-50 disabled:pointer-events-none dark:hover:bg-blue-900 dark:text-blue-400"
                href="#">
                Sign up
            </a>
            {{/if}}

            {{#if yearly_price}}
            <a href="javascript:" data-plan="annual" data-portal="signup/{{id}}/yearly"
                class="mt-5 py-3 px-4 inline-flex justify-center items-center gap-x-2 text-sm font-semibold rounded-lg border border-transparent bg-blue-100 text-blue-800 hover:bg-blue-200 disabled:opacity-50 disabled:pointer-events-none dark:hover:bg-blue-900 dark:text-blue-400"
                href="#">
                Sign up
            </a>
            {{/if}}
        </div>
        {{/foreach}}
    </div>
</div>
{{/get}}
<style>
    [data-plan="monthly"] {
        display: none;
    }

    [data-plan="annual"] {
        display: block;
    }
</style>


<script>
    document.addEventListener('DOMContentLoaded', () => {
        const calculateDiscounts = () => {
            console.log('Calculating discounts...');
            document.querySelectorAll('[data-discount]').forEach(plan => {
                const monthly = parseFloat(plan.getAttribute('data-monthly-price'));
                const yearly = parseFloat(plan.getAttribute('data-yearly-price'));
                console.log(`Monthly: ${monthly}, Yearly: ${yearly}`);
                const discount = Math.round(100 - (yearly / (12 * monthly) * 100));
                console.log(`Discount: ${discount}%`);
                if (discount > 0 && discount < 100) {
                    plan.textContent = `${discount}% off`;
                    plan.setAttribute('data-discount', `${discount}%`);
                } else {
                    plan.textContent = "No discount";
                }
            });
        };

        const onDataPlanSwitch = () => {
            const planToggle = document.querySelector('.js-plan-toggle');
            const isChecked = planToggle.checked;
            const planElements = document.querySelectorAll('[data-plan]');
            planElements.forEach(element => {
                if (isChecked && element.getAttribute('data-plan') === 'annual') {
                    element.style.display = 'block';
                } else if (!isChecked && element.getAttribute('data-plan') === 'monthly') {
                    element.style.display = 'block';
                } else {
                    element.style.display = 'none';
                }
            });
        };

        document.querySelector('.js-plan-toggle').addEventListener('change', onDataPlanSwitch);

        onDataPlanSwitch(); // Set initial display based on toggle state
        calculateDiscounts(); // Calculate discounts right after the DOM is fully loaded
    });
</script>
